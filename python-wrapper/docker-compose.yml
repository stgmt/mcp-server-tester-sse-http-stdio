# üê≥ Docker Compose –¥–ª—è MCP Server Tester
#
# –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
# 1. Standalone —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
# 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ MCP —Å–µ—Ä–≤–µ—Ä–∞–º–∏
# 3. Development –æ–∫—Ä—É–∂–µ–Ω–∏–µ

version: '3.8'

services:
  # –û—Å–Ω–æ–≤–Ω–æ–π MCP Server Tester —Å–µ—Ä–≤–∏—Å
  mcp-tester:
    build: 
      context: .
      dockerfile: Dockerfile
    image: mcp-server-tester:latest
    container_name: mcp-server-tester
    volumes:
      # –ú–æ–Ω—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫–∞–∫ workspace
      - ./:/workspace
      # –ú–æ–Ω—Ç–∏—Ä—É–µ–º –ø—Ä–∏–º–µ—Ä—ã –∏ —Ç–µ—Å—Ç—ã
      - ./examples:/workspace/examples
      - ./tests:/workspace/tests
    working_dir: /workspace
    environment:
      - MCP_TESTER_DEFAULT_TIMEOUT=30000
      - MCP_TESTER_DEFAULT_FORMAT=console
    networks:
      - mcp-network
    profiles:
      - default
    # –ö–æ–º–∞–Ω–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
    command: ["--help"]

  # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  mcp-tester-dev:
    extends: mcp-tester
    container_name: mcp-server-tester-dev
    profiles:
      - dev
    stdin_open: true
    tty: true
    # –ó–∞–ø—É—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º bash
    command: ["bash"]
    volumes:
      - ./:/workspace
      - /var/run/docker.sock:/var/run/docker.sock  # –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Docker-based MCP —Å–µ—Ä–≤–µ—Ä–æ–≤

  # –ü—Ä–∏–º–µ—Ä: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP MCP —Å–µ—Ä–≤–µ—Ä–∞
  test-http-server:
    extends: mcp-tester
    container_name: mcp-tester-http-example
    profiles:
      - examples
    command: [
      "tools", 
      "examples/http-test.yaml", 
      "--server-config", "examples/http-config.json",
      "--server-name", "example-http-server"
    ]
    depends_on:
      - example-http-server

  # –ü—Ä–∏–º–µ—Ä: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SSE MCP —Å–µ—Ä–≤–µ—Ä–∞  
  test-sse-server:
    extends: mcp-tester
    container_name: mcp-tester-sse-example
    profiles:
      - examples
    command: [
      "tools",
      "examples/sse-test.yaml",
      "--server-config", "examples/sse-config.json", 
      "--server-name", "example-sse-server"
    ]
    depends_on:
      - example-sse-server

  # –ü—Ä–∏–º–µ—Ä—ã MCP —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  example-http-server:
    image: nginx:alpine
    container_name: example-http-server
    profiles:
      - examples
    ports:
      - "8080:80"
    volumes:
      - ./examples/http-server:/usr/share/nginx/html
    networks:
      - mcp-network

  example-sse-server:
    image: node:20-alpine
    container_name: example-sse-server  
    profiles:
      - examples
    ports:
      - "8001:8001"
    working_dir: /app
    volumes:
      - ./examples/sse-server:/app
    networks:
      - mcp-network
    command: ["node", "server.js"]

networks:
  mcp-network:
    driver: bridge
    name: mcp-network